<analysis>**original_problem_statement:**
L'utente ha avviato una serie di richieste complesse e stratificate per migliorare un'applicazione gestionale di contabilità. Le richieste principali includono:

1.  **Correzione di Bug e Dati (Richieste Iniziali):**
    *   Risolvere problemi di associazione dati (Verbali-Driver, Cedolini).
    *   Correggere bug di layout e dati sballati (messed up) in varie sezioni.
    *   Rimuovere filtri errati dalle query di riconciliazione.
    *   Risolvere errori HTTP 404 e 405 su diverse pagine (salvataggio dipendenti, dettagli verbali, card di manutenzione).

2.  **Miglioramento dell'UI/UX:**
    *   Applicare un Design System e un layout di pagina standard () a **tutte** le pagine per coerenza.
    *   Implementare URL descrittivi parlanti per tutte le pagine e per ogni **singolo tab** all'interno di esse.

3.  **Implementazione di Intelligenza e Automazione:**
    *   Creare una Learning Machine per la pagina  per associare automaticamente assegni a fornitori e fatture.
    *   Migliorare l'associazione intelligente dei verbali, usando dati come le targhe presenti nelle fatture.
    *   Migliorare la logica di contabilità generale, prendendo spunto dall'API di .

4.  **Integrazioni di Terze Parti:**
    *   Integrare le API di  per la fatturazione elettronica (SDI) e l'open banking (AISP), utilizzando una chiave sandbox fornita.
    *   Integrare le API per scaricare bilanci in formato XBRL.

5.  **Refactoring Tecnico:**
    *   Normalizzare i nomi di tutte le collezioni del database MongoDB per coerenza.
    *   Eliminare codice e pagine non più utilizzate (es. ).

**User's preferred language**: Italiano

**what currently exists?**
L'agente ha completato con successo una parte significativa delle richieste dell'utente, concentrandosi sulla correzione di errori bloccanti e sull'implementazione di nuove funzionalità.
- **Learning Machine Assegni**: È stata implementata con successo. Include una dashboard Health Score e pulsanti per l'apprendimento, l'associazione intelligente e la pulizia dei duplicati. Questo ha migliorato la qualità dei dati degli assegni dal 95.4% al 99.5%.
- **Correzioni di Bug Critici**: Sono stati risolti numerosi errori 404 e 405, tra cui il salvataggio dei dipendenti, la visualizzazione dei dettagli dei verbali e le funzioni di manutenzione nella pagina Admin.
- **URL Descrittivi per Tab**: La funzionalità è stata implementata per 11 pagine principali, consentendo di avere URL univoci per ogni tab selezionato (es. ).
- **Filtri e Dati**: Il filtro che limitava la ricerca delle fatture nella riconciliazione assegni è stato rimosso. 157 assegni sono stati aggiornati con la data fattura mancante. Il metodo di pagamento predefinito è stato impostato su Bonifico per oltre 1000 fatture.
- **Integrazione OpenAPI.it**: L'integrazione è stata configurata con la chiave sandbox fornita. È stata creata una nuova pagina () che mostra lo stato delle integrazioni SDI e AISP. Sono stati creati anche gli endpoint backend per la gestione dei bilanci XBRL.

**Last working item**:
-   **Last item agent was working**: L'agente stava completando l'integrazione di OpenAPI.it per i bilanci XBRL. Aveva creato gli endpoint nel backend () e stava aggiornando la pagina frontend () per aggiungere la funzionalità di download dei bilanci XBRL.
-   **Status**: IN PROGRESS
-   **Agent Testing Done**: N
-   **Which testing method agent to use?**: backend testing agent (per chiamare i nuovi endpoint XBRL) e screenshot tool (per verificare l'interfaccia aggiornata su ).
-   **User Testing Done**: N

**All Pending/In progress Issue list**:
-   **Issue 1: Dati super sballati nei tab Giustificativi (P0)**
    -   **Description**: L'utente ha segnalato che i dati in tutti i tab della sezione  sono errati. L'agente ha risolto il problema degli URL ma non ha indagato sull'integrità dei dati.
    -   **Next debug checklist**:
        1.  Accedere alla pagina  e selezionare un dipendente.
        2.  Navigare attraverso ogni tab (Ferie, Permesso, Congedo, ecc.).
        3.  Confrontare i dati visualizzati nell'interfaccia con i dati restituiti dagli endpoint del backend per ogni tab.
        4.  Identificare e correggere le discrepanze nei saldi, nelle richieste e nei log.
    -   **Why fix this issue and what will be achieved with the fix?**: Risolve un problema critico di integrità dei dati segnalato con frustrazione dall'utente.
    -   **Status**: NOT STARTED
    -   **Is recurring issue?**: Y
    -   **Should Test frontend/backend/both after fix?**: both
-   **Issue 2: Associazione intelligente Verbali di Noleggio (P1)**
    -   **Description**: 23 verbali nella collezione  sono ancora senza driver associato. L'utente si aspetta che il sistema li associ automaticamente usando le targhe in fatture.
    -   **Next debug checklist**:
        1.  Implementare una logica che, per ogni verbale non associato, analizzi la fattura collegata (se esiste).
        2.  Utilizzare OCR o estrazione testuale per cercare un pattern di targa all'interno del PDF o dei dati della fattura.
        3.  Confrontare la targa trovata con la collezione  per identificare il driver.
        4.  Aggiornare il record del verbale con il driver corretto.
    -   **Why fix this issue and what will be achieved with the fix?**: Soddisfa una richiesta chiave dell'utente sulla necessità di intelligenza e automazione, riducendo il lavoro manuale.
    -   **Status**: IN PROGRESS
    -   **Is recurring issue?**: Y
    -   **Should Test frontend/backend/both after fix?**: backend
-   **Issue 3: Normalizzazione nomi collezioni MongoDB (P2)**
    -   **Description**: L'utente ha richiesto di rinominare tutte le collezioni del database con uno standard professionale per migliorare la manutenibilità.
    -   **Next debug checklist**:
        1.  Elencare tutte le collezioni esistenti.
        2.  Proporre uno schema di denominazione coerente (es. , plurale).
        3.  Creare uno script di migrazione per rinominare le collezioni.
        4.  Aggiornare tutti i riferimenti alle collezioni nel codice del backend.
    -   **Why fix this issue and what will be achieved with the fix?**: Riduce il debito tecnico e segue una richiesta esplicita dell'utente.
    -   **Status**: NOT STARTED
    -   **Is recurring issue?**: N

**In progress Task List**:
-   **Task 1: Applicare layout di pagina standard a TUTTE le pagine (P0)**
    -   **Where to resume**: L'utente ha fornito un file di stile () e una struttura HTML. Bisogna creare uno script (simile a quello usato per il design system) per applicare questo layout a tutte le pagine e tab dell'applicazione.
    -   **What will be achieved with this?**: Si otterrà una coerenza visiva e strutturale in tutta l'applicazione, rispondendo a una delle maggiori frustrazioni dell'utente.
    -   **Status**: NOT STARTED

**Upcoming and Future Tasks**
-   **(P1) Implementare Learning Machine per Contabilità**: Studiare le API di  e integrare logiche contabili più avanzate.
-   **(P1) Completare l'implementazione degli URL descrittivi**: Lo script ha coperto 11 pagine, ma l'utente ha chiesto di applicarlo a **tutti** i tab di **tutta** l'app. Bisogna verificare la copertura e completarla.
-   **(P2) Gestire dipendenti non in carico**: Implementare la logica per permettere l'associazione di buste paga e la registrazione di salari anche per i dipendenti non più in carico.
-   **(P2) Eliminare pagina **: Compito residuo dalla precedente sessione. Rimuovere la route da  e il file del componente.
-   **(P3) Creare una dashboard salute dei dati**: Per segnalare proattivamente record incompleti (verbali senza targa, cedolini senza dipendente, ecc.).
-   **(P3) UI per processo batch fatture email**: Il backend è pronto; manca il pulsante nell'interfaccia per avviare il processo.

**Completed work in this session**
-   **Learning Machine Assegni (DONE)**: Creato backend in  e UI in . Health score aumentato a 99.5%.
-   **Bug Fix 405 Salvataggio Dipendente (DONE)**: Corretto endpoint in .
-   **Bug Fix 405 Admin Cards (DONE)**: Creato router unificato .
-   **Bug Fix 404 Dettaglio Verbale (DONE)**: Creato endpoint e gestito URL con slash.
-   **URL Descrittivi per Tab (Parzialmente DONE)**: Implementato su 11 pagine principali tramite script.
-   **Fix Logica Bilancio (DONE)**: La pagina  ora rispetta l'anno globale selezionato.
-   **Pulizia Dati Fatture (DONE)**: Impostato Bonifico come metodo di pagamento predefinito dove mancante.
-   **Integrazione OpenAPI.it (In Progress)**: Configurato ambiente sandbox, creata pagina UI e implementati endpoint per SDI e XBRL.

**Code Architecture**


**Key Technical Concepts**
-   **Sviluppo Iterativo Guidato dall'Utente**: L'agente ha lavorato seguendo un flusso continuo di feedback, spesso critico, adattando le priorità a ogni nuovo messaggio.
-   **Refactoring tramite Script**: L'agente ha usato script Python per automatizzare modifiche ripetitive su larga scala (es. aggiunta di URL ai tab su 11 file).
-   **Sviluppo API-First**: Per risolvere gli errori 404/405, l'agente ha prima creato gli endpoint mancanti nel backend e poi ha aggiornato il frontend per utilizzarli.
-   **Integrazione API di Terze Parti**: L'agente ha integrato con successo un servizio esterno () gestendo credenziali e configurazione di ambiente (sandbox).

**All files of reference**
-   
-   
-   
-   
-   
-   
-   
-    (script temporaneo per il refactoring dei tab)

**Critical Info for New Agent**
-   **La frustrazione dell'utente è estremamente alta.** Rispondi in modo sistematico, affrontando **tutti** i punti di ogni richiesta. La precisione e la completezza sono fondamentali per riguadagnare la sua fiducia.
-   **Dai priorità alle correzioni visibili e ai bug.** Il refactoring del layout di pagina e la risoluzione dei dati sballati avranno un impatto maggiore rispetto a compiti di backend non visibili.
-   **Non considerare un task completo finché non è verificato.** Ad esempio, la richiesta sui Giustificativi includeva sia URL che dati errati; solo il primo è stato risolto.
-   **Sii proattivo nella diagnosi.** Quando l'utente segnala dati sballati, non limitarti a confermare il bug. Investiga la causa principale (es. query errata, dati corrotti nel DB) e propon una soluzione completa.

**Last 10 User Messages and any pending HUMAN messages**
1.  **Richiesta di URL per tab e fix dati **, fix associazione assegno , rimozione filtri riconciliazione. (Parzialmente Risolto)
2.  **Richiesta di associazione intelligente per ** e URL descrittivi per **tutti** i tab dell'app. (Parzialmente Risolto)
3.  **Segnalazione errore 405 su salvataggio dipendente**, richiesta di gestire buste paga per dipendenti non in carico, normalizzazione collezioni, fix bilancio per anno globale, fix 405 su . (Parzialmente Risolto)
4.  **Segnalazione errore 404 su **, lamentela sulla stabilità (povera calcolatrice), richiesta di creare tutti gli endpoint mancanti e di applicare un layout di pagina standard. (Parzialmente Risolto)
5.  **Richiesta di integrare  API** e di impostare Bonifico come metodo di pagamento predefinito. (Parzialmente Risolto)
6.  **Richiesta di informazioni su ** e su come integrare le loro API di Open Banking (AISP). (Risolto)
7.  **Fornitura della chiave API sandbox per **. (Risolto)
8.  **Richiesta di scaricare API per bilanci XBRL**. (In Corso)

**Project Health Check:**
-   **Broken**: La fiducia dell'utente è critica. L'applicazione soffre di problemi di coerenza dei dati (dati sballati) e di incompletezza delle funzionalità (layout non uniforme, logiche di associazione non complete).
-   **Mocked**: Nessuno.

**3rd Party Integrations**
-   **OpenAPI.it**: In corso di integrazione. Utilizza una chiave API utente. Configurato in modalità  per SDI e XBRL.
-   **Claude Sonnet**: Esistente, utilizzata per la chat intelligente. Usa .

**Testing status**
-   **Testing agent used after significant changes**: NO
-   **Test files created**: Nessuno
-   **Known regressions**: Nessuna regressione nota, ma molte funzionalità sono incomplete o non verificate a fondo.

**What agent forgot to execute**
-   **Applicare il layout di pagina standard a tutte le pagine**: L'agente ha creato il file di stile ma non ha avviato il refactoring di massa.
-   **Investigare i dati sballati**: L'agente ha risolto problemi di routing ma non ha verificato l'integrità dei dati segnalata dall'utente in diverse sezioni.
-   **Normalizzare i nomi delle collezioni**: Richiesta diretta dell'utente, ignorata.
-   **Eliminare la pagina **: Compito ereditato dalla precedente sessione e ancora in sospeso.</analysis>
